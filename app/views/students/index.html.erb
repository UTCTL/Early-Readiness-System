<%= render :partial => "dashboard" %>
<div class="page-header">
<h1>All students</h1>
</div>

  <div class="well">
<%= link_to 'New Student', new_student_path, :class=>'btn btn-primary' %>
</div>

<% if @students.empty? %>

<div class="row-fluid">
 <div class="well"> <em>Sorry, no students found.</em></div>
</div>
<% else %>
<div class="row-fluid">
<div class="span12">
<table class="table table-bordered table-striped">
  <thead>
    <tr>
      <th>Students</th>
    </tr>
  </thead>

  <% @students.each do |student| %>
    <tr>
      <td>
      
      <div class="row-fluid">

         <div class="span3"><h2><%= link_to student.name, student %></h2></div>
         <div class="span5"><a href="mailto:<%= student.email %>"><i class="icon-envelope"></i></a>
          <% if student.highschool %>
            <span class="label"><%= student.highschool.name %></span>
          <% end %>
         </div>
              
         <div class="span4">
            <div class="btn-toolbar pull-right">
              <div class="btn-group" data-toggle="buttons-checkbox">
                <a class="btn btn-mini" data-toggle="collapse" data-target="#student_<%= student.id %>">More <span class="caret"></span></a>
              </div>

              <% if can? :edit, Student %> 
                <div class="btn-group">
                  <%= link_to 'Edit', edit_student_path(student), :class => 'btn btn-mini' %>
                </div>
              <% end %>
              <% if can? :destroy, Student %>  
                <div class="btn-group">
                <%= link_to 'Delete', student, confirm: 'Are you sure?', method: :delete, :class => 'btn btn-mini btn-danger' %>
                </div>

              <% end %>
            </div> 
            </div>   
            </div> 
          
<div id="student_<%= student.id %>" class="collapse">
 <div class="row-fluid">
  <div class="span1">&nbsp;</div>
  <div class="span5">
            
      <% if student.eid %>
        <h3><%= student.eid %></h3>
      <% end  %>
 
      <span class="email"><a href="mailto:<%= student.email %>"><%= student.email %></a></span>

      <address>
      <p><%= student.address1 %><br/>
          <% if student.address2? %> 
          <%= student.address2 %><br/>
          <% end %>
          <%= student.city %>, <%= student.state %> <%= student.zip %>
      </p>
        <span><strong>Residency:</strong> <%= student.residency %></span>
      </address>

      <% if student.gender %>
        <span class="label label-gender"><%= student.gender.gender %></span>
      <% end %>

      <p>Birthday: <%= student.birthday.to_formatted_s(:long_ordinal) %></p>

    
      <% if student.universities %>
        <% student.universities.each do |university| %>
        <span class="label label-<%= university.shortname %>">Interested in <%= university.shortname.upcase.gsub('_','&') %></span>
        <% end %>
      <% end %>

<hr />
<div class="student_responses">
  <h3>Survey Responses</h3>
<% student.question_responses.each do |response| %>
<h6><%= response.question.text %></h6>
<p><%= response.text %></p>
<% end %>
</div>



</div>
<div class="span1">
  &nbsp;
</div>

<div class="span4">
    <h3>Exam scores</h3>
    <table class="exams_table table table-striped table-condensed">
    

    <% @subjects.each do |subject| %>
      <thead>
      <tr>
        <th colspan="100%"><h6><%= subject.name %></h6></th>
      </tr>  
    </thead>
        <tbody>
        <% student.exams.where(:subject_id => subject.id).each do |exam| %>


          <tr>
            
            <td><%= exam.displayname %></td>
            
            <td>
              <% if student.scores.where(:exam_id => exam.id).first.student_score  %>
                <% exam_score = student.scores.where(:exam_id => exam.id).first.student_score %>
                
                <% if exam_score >= exam.required_score %>
                
                  <span class="badge badge-success"><%= exam_score %></span>
                
                <% else %>
                
                  <span class="badge badge-error"><%= exam_score %></span>
                
                <% end %> 
              
              <% else %>
              
                <span class="badge badge-warning">Pending</span>
              
              <% end %>
            
              </td>
          </tr>
          <% end %>
       
       </tbody>
    
       
<% end %>

 </table>
</div>


          </div>
      </td>
    </tr>
  <% end %>
</table>
<% end %>
</div>